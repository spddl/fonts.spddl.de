angular.module("me-lazyload",[]).directive("lazySrc",["$window","$document",function(e,t){function n(e){var t=e.data("__uid");return t||e.data("__uid",t=""+ ++d),t}function a(){var e,t="number"==typeof f.pageXOffset?f.pageXOffset:(((e=c.documentElement)||(e=l.parentNode))&&"number"==typeof e.ScrollLeft?e:l).ScrollLeft,n="number"==typeof f.pageYOffset?f.pageYOffset:(((e=c.documentElement)||(e=l.parentNode))&&"number"==typeof e.ScrollTop?e:l).ScrollTop;return{offsetX:t,offsetY:n}}function o(e){var t,n,o=e[0],i=o.getBoundingClientRect(),r=a(),l=r.offsetX,s=r.offsetY,d=i.width,u=i.height,p=i.left+l,m=i.top+s,y=Math.max(c.documentElement.clientWidth,f.innerWidth||0),b=Math.max(c.documentElement.clientHeight,f.innerHeight||0);return s>=m?m+u>=s&&(n=!0):m>=s&&s+b>=m&&(n=!0),l>=p?p+d>=l&&(t=!0):p>=l&&l+y>=p&&(t=!0),t&&n}function i(){Object.keys(u).forEach(function(e){var t=u[e],n=t.iElement,a=t.$scope;o(n)&&n.attr("src",a.lazySrc)})}function r(){var e=angular.element(this),t=n(e);e.css("opacity",1),u.hasOwnProperty(t)&&delete u[t]}var c=t[0],l=c.body,f=e,s=angular.element(f),d=0,u={};return s.bind("scroll",i),s.bind("resize",i),{restrict:"A",scope:{lazySrc:"@",animateVisible:"@",animateSpeed:"@"},link:function(e,t){t.bind("load",r),e.$watch("lazySrc",function(){var a="1s";if(null!=e.animateSpeed&&(a=e.animateSpeed),o(t))e.animateVisible&&t.css({"background-color":"#fff",opacity:0,"-webkit-transition":"opacity "+a,transition:"opacity "+a}),t.attr("src",e.lazySrc);else{var i=n(t);t.css({"background-color":"#fff",opacity:0,"-webkit-transition":"opacity "+a,transition:"opacity "+a}),u[i]={iElement:t,$scope:e}}}),e.$on("$destroy",function(){t.unbind("load");var e=n(t);u.hasOwnProperty(e)&&delete u[e]})}}}]);